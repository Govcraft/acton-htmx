//! {{model_name}} form validation
//!
//! Generated by acton-dx scaffold

use serde::{Deserialize, Serialize};
use validator::Validate;
{{#if has_date_fields}}
use chrono::{NaiveDate, NaiveDateTime, DateTime, Utc};
{{/if}}
{{#if has_decimal}}
use rust_decimal::Decimal;
{{/if}}
{{#if has_uuid}}
use uuid::Uuid;
{{/if}}
{{#if has_enum}}
use super::models::{{model_snake}}::{
    {{#each enums}}
    {{name}},
    {{/each}}
};
{{/if}}

/// {{model_name}} form for creation and updates
#[derive(Debug, Clone, Serialize, Deserialize, Validate)]
pub struct {{model_name}}Form {
    {{#each fields}}
    {{#if validations}}
    {{#each validations}}
    #[validate({{this}})]
    {{/each}}
    {{/if}}
    pub {{name}}: {{rust_type}},
    {{/each}}
}

impl {{model_name}}Form {
    /// Create a new form instance
    pub fn new(
        {{#each fields}}
        {{name}}: {{rust_type}},
        {{/each}}
    ) -> Self {
        Self {
            {{#each fields}}
            {{name}},
            {{/each}}
        }
    }

    /// Validate the form
    pub fn validate(&self) -> Result<(), validator::ValidationErrors> {
        Validate::validate(self)
    }
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_form_creation() {
        let form = {{model_name}}Form::new(
            {{#each fields}}
            {{#if optional}}
            None,
            {{else}}
            {{default_value}},
            {{/if}}
            {{/each}}
        );
        assert!(form.validate().is_ok());
    }
}
